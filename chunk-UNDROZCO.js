import{a as ze}from"./chunk-BERH3WGB.js";import{a as s,b as f,c as Re,d as B,e as fe,f as $e,g as se,h as ge,i as j,j as A,k as g,l as H,m as Z,n as ee}from"./chunk-PRHRZYX4.js";import{$ as Te,A as he,B as w,C as k,D as pe,E as Ee,G as N,H as p,I as ue,K as L,L as me,La as Le,M as S,N as v,O as P,P as V,Q as W,R as T,S as d,T as l,U as x,V as y,W as _,X as h,Y as I,Z as Ve,_ as We,a as Y,b as ke,ba as C,c as Me,da as O,ea as R,f as ye,fa as Q,g as U,ga as b,ha as X,i as be,ia as z,j as Pe,ka as Ie,la as Ae,o as Se,oa as J,p as Oe,q as Be,qa as He,r as de,sa as Ne,u as qe,v as E,w as D,z as Fe}from"./chunk-FKIAD4CJ.js";import{Y as De,a as re,b as xe,c as we,d as K}from"./chunk-XRBH25AC.js";var q=class extends j{constructor(o){super(o),this.pieceColor=o,this._directions=[{x:1,y:1},{x:1,y:-1},{x:-1,y:1},{x:-1,y:-1}],this._FENChar=o===s.White?f.WhiteBishop:f.BlackBishop}};var F=class extends j{constructor(o){super(o),this.pieceColor=o,this._directions=[{x:1,y:2},{x:1,y:-2},{x:-1,y:2},{x:-1,y:-2},{x:2,y:1},{x:2,y:-1},{x:-2,y:1},{x:-2,y:-1}],this._FENChar=o===s.White?f.WhiteKnight:f.BlackKnight}};var $=class extends j{constructor(o){super(o),this.pieceColor=o,this._directions=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1},{x:1,y:1},{x:1,y:-1},{x:-1,y:1},{x:-1,y:-1}],this._FENChar=o===s.White?f.WhiteQueen:f.BlackQueen}};var te=class r{constructor(){this.chessBoardSize=8,this._playerColor=s.White,this._checkState={isInCheck:!1},this.fiftyMoveRuleCounter=0,this._isGameOver=!1,this.fullNumberOfMoves=1,this.threeFoldRepetitionDictionary=new Map,this.threeFoldRepetitionFlag=!1,this._boardAsFEN=Z.initialPosition,this.FENConverter=new Z,this._moveList=[],this._moves=[],this.chessBoard=[[new H(s.White),new F(s.White),new q(s.White),new $(s.White),new A(s.White),new q(s.White),new F(s.White),new H(s.White)],[new g(s.White),new g(s.White),new g(s.White),new g(s.White),new g(s.White),new g(s.White),new g(s.White),new g(s.White)],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[new g(s.Black),new g(s.Black),new g(s.Black),new g(s.Black),new g(s.Black),new g(s.Black),new g(s.Black),new g(s.Black)],[new H(s.Black),new F(s.Black),new q(s.Black),new $(s.Black),new A(s.Black),new q(s.Black),new F(s.Black),new H(s.Black)]],this._safeSquares=this.findSafeSqures(),this._gameHistory=[{board:this.chessBoardView,lastMove:this._lastMove,checkState:this._checkState}]}get playerColor(){return this._playerColor}get chessBoardView(){return this.chessBoard.map(o=>o.map(i=>i instanceof j?i.FENChar:null))}get safeSquares(){return this._safeSquares}get lastMove(){return this._lastMove}get checkState(){return this._checkState}get isGameOver(){return this._isGameOver}get gameOverMessage(){return this._gameOverMessage}get boardAsFEN(){return this._boardAsFEN}get moveList(){return this._moveList}get moves(){return this._moves}get gameHistory(){return this._gameHistory}resetBoard(){this.chessBoard=Qe,this._playerColor=s.White,this._safeSquares=this.findSafeSqures(),this._lastMove=void 0,this._checkState={isInCheck:!1},this._isGameOver=!1,this._gameOverMessage=void 0,this._boardAsFEN=Z.initialPosition,this._moveList=[],this._moves=[],this._gameHistory=[{board:this.chessBoardView,lastMove:this._lastMove,checkState:this._checkState}],this.fiftyMoveRuleCounter=0,this.threeFoldRepetitionFlag=!1,this.threeFoldRepetitionDictionary=new Map}static isSquareDark(o,i){return o%2===0&&i%2===0||o%2===1&&i%2===1}areCoordsValid(o,i){return o>=0&&i>=0&&o<this.chessBoardSize&&i<this.chessBoardSize}isInCheck(o,i){for(let e=0;e<this.chessBoardSize;e++)for(let t=0;t<this.chessBoardSize;t++){let n=this.chessBoard[e][t];if(!(!n||n.color===o))for(let{x:a,y:c}of n.directions){let u=e+a,m=t+c;if(this.areCoordsValid(u,m))if(n instanceof g||n instanceof F||n instanceof A){if(n instanceof g&&c===0)continue;let M=this.chessBoard[u][m];if(M instanceof A&&M.color===o)return i&&(this._checkState={isInCheck:!0,x:u,y:m}),!0}else for(;this.areCoordsValid(u,m);){let M=this.chessBoard[u][m];if(M instanceof A&&M.color===o)return i&&(this._checkState={isInCheck:!0,x:u,y:m}),!0;if(M!==null)break;u+=a,m+=c}}}return i&&(this._checkState={isInCheck:!1}),!1}isPositionSafeAfterMove(o,i,e,t){let n=this.chessBoard[o][i];if(!n)return!1;let a=this.chessBoard[e][t];if(a&&a.color===n.color)return!1;this.chessBoard[o][i]=null,this.chessBoard[e][t]=n;let c=!this.isInCheck(n.color,!1);return this.chessBoard[o][i]=n,this.chessBoard[e][t]=a,c}findSafeSqures(){let o=new Map;for(let i=0;i<this.chessBoardSize;i++)for(let e=0;e<this.chessBoardSize;e++){let t=this.chessBoard[i][e];if(!t||t.color!==this._playerColor)continue;let n=[];for(let{x:a,y:c}of t.directions){let u=i+a,m=e+c;if(!this.areCoordsValid(u,m))continue;let M=this.chessBoard[u][m];if(!(M&&M.color===t.color)&&!(t instanceof g&&((a===2||a===-2)&&(M||this.chessBoard[u+(a===2?-1:1)][m])||(a===1||a===-1)&&c===0&&M||(c===1||c===-1)&&(!M||t.color===M.color))))if(t instanceof g||t instanceof F||t instanceof A)this.isPositionSafeAfterMove(i,e,u,m)&&n.push({x:u,y:m});else for(;this.areCoordsValid(u,m)&&(M=this.chessBoard[u][m],!(M&&M.color===t.color||(this.isPositionSafeAfterMove(i,e,u,m)&&n.push({x:u,y:m}),M!==null)));)u+=a,m+=c}t instanceof A?(this.canCastle(t,!0)&&n.push({x:i,y:6}),this.canCastle(t,!1)&&n.push({x:i,y:2})):t instanceof g&&this.canCaptureEnPassant(t,i,e)&&n.push({x:i+(t.color===s.White?1:-1),y:this._lastMove.prevY}),n.length&&o.set(i+","+e,n)}return o}canCaptureEnPassant(o,i,e){if(!this._lastMove)return!1;let{piece:t,prevX:n,prevY:a,currX:c,currY:u}=this._lastMove;if(!(t instanceof g)||o.color!==this._playerColor||Math.abs(c-n)!==2||i!==c||Math.abs(e-u)!==1)return!1;let m=i+(o.color===s.White?1:-1),M=u;this.chessBoard[c][u]=null;let G=this.isPositionSafeAfterMove(i,e,m,M);return this.chessBoard[c][u]=t,G}canCastle(o,i){if(o.hasMoved)return!1;let e=o.color===s.White?0:7,t=4,n=e,a=i?7:0,c=this.chessBoard[n][a];if(!(c instanceof H)||c.hasMoved||this._checkState.isInCheck)return!1;let u=t+(i?1:-1),m=t+(i?2:-2);return this.chessBoard[e][u]||this.chessBoard[e][m]||!i&&this.chessBoard[e][1]?!1:this.isPositionSafeAfterMove(e,t,e,u)&&this.isPositionSafeAfterMove(e,t,e,m)}move(o,i,e,t,n){if(this._isGameOver)throw new Error("Game is over, you cant play move");if(!this.areCoordsValid(o,i)||!this.areCoordsValid(e,t))return;let a=this.chessBoard[o][i];if(!a||a.color!==this._playerColor)return;let c=this._safeSquares.get(o+","+i);(!c||!c.find(G=>G.x===e&&G.y===t))&&(a instanceof g||a instanceof A||a instanceof H)&&!a.hasMoved&&(a.hasMoved=!0);let u=new Set,m=this.chessBoard[e][t]!==null;m&&u.add(B.Capture),a instanceof g||m?this.fiftyMoveRuleCounter=0:this.fiftyMoveRuleCounter+=.5,this.handlingSpecialMoves(a,o,i,e,t,u),n?(this.chessBoard[e][t]=this.promotedPiece(n),u.add(B.Promotion)):this.chessBoard[e][t]=a,this.chessBoard[o][i]=null,this._lastMove={prevX:o,prevY:i,currX:e,currY:t,piece:a,moveType:u},this._playerColor=this._playerColor===s.White?s.Black:s.White,this.isInCheck(this._playerColor,!0);let M=this.findSafeSqures();this._checkState.isInCheck?u.add(M.size?B.Check:B.CheckMate):u.size||u.add(B.BasicMove),this.storeMove(n),this.updateGameHistory(),this._safeSquares=M,this._playerColor===s.White&&this.fullNumberOfMoves++,this._boardAsFEN=this.FENConverter.convertBoardToFEN(this.chessBoard,this._playerColor,this._lastMove,this.fiftyMoveRuleCounter,this.fullNumberOfMoves),this.updateThreeFoldRepetitionDictionary(this._boardAsFEN),this._isGameOver=this.isGameFinished()}handlingSpecialMoves(o,i,e,t,n,a){if(o instanceof A&&Math.abs(n-e)===2){let c=i,u=n>e?7:0,m=this.chessBoard[c][u],M=n>e?5:3;this.chessBoard[c][u]=null,this.chessBoard[c][M]=m,m.hasMoved=!0,a.add(B.Castling)}else o instanceof g&&this._lastMove&&this._lastMove.piece instanceof g&&Math.abs(this._lastMove.currX-this._lastMove.prevX)===2&&i===this._lastMove.currX&&n===this._lastMove.currY&&(this.chessBoard[this._lastMove.currX][this._lastMove.currY]=null,a.add(B.Capture))}promotedPiece(o){return o===f.WhiteKnight||o===f.BlackKnight?new F(this._playerColor):o===f.WhiteBishop||o===f.BlackBishop?new q(this._playerColor):o===f.WhiteRook||o===f.BlackRook?new H(this._playerColor):new $(this._playerColor)}isGameFinished(){if(this.insufficientMaterial())return this._gameOverMessage="Draw due insufficient material",!0;if(!this._safeSquares.size){if(this._checkState.isInCheck){let o=this._playerColor===s.White?"Black":"White";this._gameOverMessage=o+" won by checkmate"}else this._gameOverMessage="Stalemate";return!0}return this.threeFoldRepetitionFlag?(this._gameOverMessage="Draw due three fold repetition rule",!0):this.fiftyMoveRuleCounter===50?(this._gameOverMessage="Draw due fifty move rule",!0):!1}playerHasOnlyTwoKnightsAndKing(o){return o.filter(i=>i.piece instanceof F).length===2}playerHasOnlyBishopsWithSameColorAndKing(o){let i=o.filter(t=>t.piece instanceof q),e=new Set(i.map(t=>r.isSquareDark(t.x,t.y))).size===1;return i.length===o.length-1&&e}insufficientMaterial(){let o=[],i=[];for(let e=0;e<this.chessBoardSize;e++)for(let t=0;t<this.chessBoardSize;t++){let n=this.chessBoard[e][t];n&&(n.color===s.White?o.push({piece:n,x:e,y:t}):i.push({piece:n,x:e,y:t}))}if(o.length===1&&i.length===1)return!0;if(o.length===1&&i.length===2)return i.some(e=>e.piece instanceof F||e.piece instanceof q);if(o.length===2&&i.length===1)return o.some(e=>e.piece instanceof F||e.piece instanceof q);if(o.length===2&&i.length===2){let e=o.find(n=>n.piece instanceof q),t=i.find(n=>n.piece instanceof q);if(e&&t)return r.isSquareDark(e.x,e.y)&&r.isSquareDark(t.x,t.y)||!r.isSquareDark(e.x,e.y)&&!r.isSquareDark(t.x,t.y)}return!!(o.length===3&&i.length===1&&this.playerHasOnlyTwoKnightsAndKing(o)||o.length===1&&i.length===3&&this.playerHasOnlyTwoKnightsAndKing(i)||o.length>=3&&i.length===1&&this.playerHasOnlyBishopsWithSameColorAndKing(o)||o.length===1&&i.length>=3&&this.playerHasOnlyBishopsWithSameColorAndKing(i))}updateThreeFoldRepetitionDictionary(o){let i=o.split(" ").slice(0,4).join(""),e=this.threeFoldRepetitionDictionary.get(i);if(e===void 0)this.threeFoldRepetitionDictionary.set(i,1);else{if(e===2){this.threeFoldRepetitionFlag=!0;return}this.threeFoldRepetitionDictionary.set(i,2)}}storeMove(o){let{piece:i,currX:e,currY:t,prevX:n,prevY:a,moveType:c}=this._lastMove,u=i instanceof g?"":i.FENChar.toUpperCase(),m;c.has(B.Castling)?m=t-a===2?"O-O":"O-O-O":(m=u+this.startingPieceCoordsNotation(),c.has(B.Capture)&&(m+=i instanceof g?se[a]+"x":"x"),m+=se[t]+String(e+1),o&&(m+="="+o.toUpperCase())),c.has(B.Check)?m+="+":c.has(B.CheckMate)&&(m+="#"),this._moveList[this.fullNumberOfMoves-1]?this._moveList[this.fullNumberOfMoves-1].includes(m)||this._moveList[this.fullNumberOfMoves-1].push(m):this._moveList[this.fullNumberOfMoves-1]=[m]}startingPieceCoordsNotation(){let{piece:o,prevX:i,prevY:e,currX:t,currY:n}=this._lastMove;if(o instanceof g||o instanceof A)return"";let a=[{x:i,y:e}];for(let m=0;m<this.chessBoardSize;m++)for(let M=0;M<this.chessBoardSize;M++){let G=this.chessBoard[m][M];!G||t===m&&n===M||G.FENChar===o.FENChar&&(this._safeSquares.get(m+","+M)||[]).some(Ce=>Ce.x===t&&Ce.y===n)&&a.push({x:m,y:M})}if(a.length===1)return"";let c=new Set(a.map(m=>m.y)),u=new Set(a.map(m=>m.x));return c.size===a.length?se[e]:u.size===a.length?String(i+1):se[e]+String(i+1)}updateGameHistory(){this._gameHistory.push({board:[...this.chessBoardView.map(o=>[...o])],checkState:re({},this._checkState),lastMove:this._lastMove?re({},this._lastMove):void 0})}},Qe=[[new H(s.White),new F(s.White),new q(s.White),new $(s.White),new A(s.White),new q(s.White),new F(s.White),new H(s.White)],[new g(s.White),new g(s.White),new g(s.White),new g(s.White),new g(s.White),new g(s.White),new g(s.White),new g(s.White)],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[new g(s.Black),new g(s.Black),new g(s.Black),new g(s.Black),new g(s.Black),new g(s.Black),new g(s.Black),new g(s.Black)],[new H(s.Black),new F(s.Black),new q(s.Black),new $(s.Black),new A(s.Black),new q(s.Black),new F(s.Black),new H(s.Black)]];var Xe=["mList"],je=r=>({"current-move":r});function Je(r,o){if(r&1){let i=y();d(0,"div",10),_("click",function(){w(i);let t=h().$index,n=h();return k(n.showPreviousMoveHandler(t*2+2))}),C(1),l()}if(r&2){let i=h(),e=i.$implicit,t=i.$index,n=h();v("ngClass",b(2,je,t*2+2===n.gameHistoryPointer)),p(),O(" ",e[1]," ")}}function Ze(r,o){if(r&1){let i=y();d(0,"div",8)(1,"span",9),C(2),l(),d(3,"div",10),_("click",function(){let t=w(i).$index,n=h();return k(n.showPreviousMoveHandler(t*2+1))}),C(4),l(),S(5,Je,2,4,"div",11),l()}if(r&2){let i=o.$implicit,e=o.$index,t=h();p(2),O("",e+1,". "),p(),v("ngClass",b(4,je,e*2+1===t.gameHistoryPointer)),p(),O(" ",i[0]," "),p(),P(5,i[1]?5:-1)}}var ne=(()=>{let o=class o{constructor(){this.moveList=[],this.gameHistoryPointer=0,this.gameHistoryLength=1,this.showPreviousMove=new Ee}showPreviousMoveHandler(e){this.showPreviousMove.emit(e)}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=D({type:o,selectors:[["move-list"]],viewQuery:function(t,n){if(t&1&&Ve(Xe,5),t&2){let a;We(a=Te())&&(n.mList=a.first)}},inputs:{moveList:"moveList",gameHistoryPointer:"gameHistoryPointer",gameHistoryLength:"gameHistoryLength"},outputs:{showPreviousMove:"showPreviousMove"},standalone:!0,features:[R],decls:13,vars:4,consts:[["mList",""],[1,"actions"],[1,"chess-btn",3,"click","disabled"],["src","assets/icons/next-to-end.png","alt","",2,"transform","rotate(180deg)"],["src","assets/icons/next.png","alt","",2,"transform","rotate(180deg)"],["src","assets/icons/next.png","alt",""],["src","assets/icons/next-to-end.png","alt",""],[1,"move-list"],[1,"row"],[1,"move-number"],[1,"move",3,"click","ngClass"],[1,"move",3,"ngClass"]],template:function(t,n){if(t&1){let a=y();d(0,"div",1)(1,"button",2),_("click",function(){return w(a),k(n.showPreviousMoveHandler(0))}),x(2,"img",3),l(),d(3,"button",2),_("click",function(){return w(a),k(n.showPreviousMoveHandler(n.gameHistoryPointer-1))}),x(4,"img",4),l(),d(5,"button",2),_("click",function(){return w(a),k(n.showPreviousMoveHandler(n.gameHistoryPointer+1))}),x(6,"img",5),l(),d(7,"button",2),_("click",function(){return w(a),k(n.showPreviousMoveHandler(n.gameHistoryLength-1))}),x(8,"img",6),l()(),d(9,"div",7,0),W(11,Ze,6,6,"div",8,V),l()}t&2&&(p(),v("disabled",n.gameHistoryPointer===0),p(2),v("disabled",n.gameHistoryPointer===0),p(2),v("disabled",n.gameHistoryPointer===n.gameHistoryLength-1),p(2),v("disabled",n.gameHistoryPointer===n.gameHistoryLength-1),p(4),T(n.moveList))},dependencies:[z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;width:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{filter:invert(.5) sepia();transition:.25s ease}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:disabled):hover   img[_ngcontent-%COMP%]{filter:invert(1);transform:scale(1.05)}[_nghost-%COMP%]   .move-list[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:1rem;max-height:529px;overflow-y:auto;scroll-margin-inline:1rem;padding-block:1rem;padding-inline:.5rem}@media (max-width: 1080px){[_nghost-%COMP%]   .move-list[_ngcontent-%COMP%]{height:calc(262px + 1rem)}}[_nghost-%COMP%]   .move-list[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:auto 1fr 1fr;align-items:center;gap:.5rem;color:var(--primary-color)}.move[_ngcontent-%COMP%]{width:100%;cursor:pointer;text-align:center;padding:.5rem;border-radius:5px;transition:.25s ease;border:1px solid #444}.current-move[_ngcontent-%COMP%], .move[_ngcontent-%COMP%]:hover{background-color:#444}.move-number[_ngcontent-%COMP%]{font-weight:600;display:inline-block;min-width:40px}"]});let r=o;return r})();var ae=r=>({rotated:r}),et=()=>["a","b","c","d","e","f","g","h"],tt=(r,o,i,e,t,n,a)=>({"flipped-shadow":r,light:o,dark:i,"selected-square":e,"last-move":t,"king-in-check":n,"promotion-square":a}),it=r=>({"safe-square":r});function nt(r,o){if(r&1){let i=y();d(0,"div",0),x(1,"img",15),d(2,"p"),C(3),l(),d(4,"div",7)(5,"button",8),_("click",function(){w(i);let t=h();return k(t.gameOverMessage.set(void 0))}),C(6," OK "),l()(),d(7,"span",16),_("click",function(){w(i);let t=h();return k(t.gameOverMessage.set(void 0))}),C(8," \xD7 "),l()()}if(r&2){let i=h();p(3),O(" ",i.gameOverMessage()," ")}}function ot(r,o){if(r&1){let i=y();d(0,"div",0),x(1,"img",17),d(2,"p"),C(3),l(),d(4,"div",7)(5,"button",8),_("click",function(){w(i);let t=h();return k(t.doAction())}),C(6,"Yes"),l(),d(7,"button",8),_("click",function(){w(i);let t=h();return k(t.confirmation=void 0)}),C(8,"No"),l()()()}if(r&2){let i=h();p(),I("src",i.confirmation.img,N),I("alt",i.confirmation.action),p(2),O(" ",i.confirmation.message," ")}}function rt(r,o){if(r&1&&(d(0,"div",4),C(1),l()),r&2){let i=o.$implicit,e=h();v("ngClass",b(2,ae,e.flipMode())),p(),O(" ",i," ")}}function st(r,o){if(r&1&&x(0,"img",22),r&2){let i=h().$implicit,e=h(2);I("src",e.pieceImagePaths[i],N),I("alt",i),v("ngClass",b(3,ae,e.flipMode()))}}function at(r,o){if(r&1){let i=y();d(0,"div",20),_("click",function(){let t=w(i).$index,n=h().$index,a=h();return k(a.move(n,t))}),x(1,"div",21),S(2,st,1,5,"img",22),l()}if(r&2){let i=o.$implicit,e=o.$index,t=h().$index,n=h();v("ngClass",X(3,tt,n.flipMode(),!n.isSquareDark(t,e),n.isSquareDark(t,e),n.isSquareSelected(t,e)&&!n.chessBoard.isGameOver,n.isSquareLastMove(t,e),n.isSquareChecked(t,e),n.isSquarePromotionSquare(t,e))),p(),v("ngClass",b(11,it,n.isSquareSafeForSelectedPiece(t,e)&&!n.chessBoard.isGameOver)),p(),P(2,i?2:-1)}}function ct(r,o){if(r&1&&(d(0,"div",2)(1,"div",18),C(2),l(),W(3,at,3,13,"div",19,V),l()),r&2){let i=o.$implicit,e=o.$index,t=h();p(),v("ngClass",b(2,ae,t.flipMode())),p(),O(" ",e+1," "),p(),T(i)}}function lt(r,o){if(r&1){let i=y();d(0,"div",23)(1,"img",24),_("click",function(){let t=w(i).$implicit,n=h(2);return k(n.promotePiece(t))}),l()()}if(r&2){let i=o.$implicit,e=h(2);p(),v("src",e.pieceImagePaths[i],N)}}function dt(r,o){if(r&1){let i=y();d(0,"div",5),W(1,lt,2,1,"div",23,V),d(3,"span",16),_("click",function(){w(i);let t=h();return k(t.closePromotionDialog())}),C(4," \xD7 "),l()()}if(r&2){let i=h();v("ngClass",b(1,ae,i.flipMode())),p(),T(i.promotionPieces())}}function ht(r,o){if(r&1){let i=y();d(0,"button",8),_("click",function(){w(i);let t=h();return k(t.handleActions("reset"))}),x(1,"img",25),l()}}var oe=(()=>{let o=class o{get playerColor(){return this.chessBoard.playerColor}get safeSquares(){return this.chessBoard.safeSquares}get moveList(){return this.chessBoard.moveList}get gameHistory(){return this.chessBoard.gameHistory}promotionPieces(){return this.playerColor===s.White?[f.WhiteKnight,f.WhiteBishop,f.WhiteRook,f.WhiteQueen]:[f.BlackKnight,f.BlackBishop,f.BlackRook,f.BlackQueen]}constructor(e){this.chessBoardService=e,this.router=E(He),this.pieceImagePaths=Re,this.chessBoard=new te,this.chessBoardView=L(this.chessBoard.chessBoardView),this.gameOverMessage=L(this.chessBoard.gameOverMessage),this.selectedSquare={piece:null},this.pieceSafeSquares=[],this.lastMove=this.chessBoard.lastMove,this.checkState=this.chessBoard.checkState,this.gameHistoryPointer=0,this.isPromotionActive=!1,this.promotionCoords=null,this.promotedPiece=L(null),this.flipMode=L(!1),this.subscriptions$=new Y,this.soundsMuted=!0,this.confirmation=void 0}ngOnInit(){let e=be(document,"keyup").pipe(Pe(t=>t.key==="ArrowRight"||t.key==="ArrowLeft"),Be(t=>{switch(t.key){case"ArrowRight":if(this.gameHistoryPointer===this.gameHistory.length-1)return;this.gameHistoryPointer++;break;case"ArrowLeft":if(this.gameHistoryPointer===0)return;this.gameHistoryPointer--;break;default:break}this.showPreviousMove(this.gameHistoryPointer)})).subscribe();this.subscriptions$.add(e)}ngOnDestroy(){this.subscriptions$.unsubscribe(),this.chessBoardService.chessBoardState$.next(Z.initialPosition)}flipBoard(){this.flipMode.update(e=>!e)}isSquareDark(e,t){return te.isSquareDark(e,t)}isSquareSelected(e,t){return this.selectedSquare.piece?this.selectedSquare.x===e&&this.selectedSquare.y===t:!1}isSquareSafeForSelectedPiece(e,t){return this.pieceSafeSquares.some(n=>n.x===e&&n.y===t)}isSquareLastMove(e,t){if(!this.lastMove)return!1;let{prevX:n,prevY:a,currX:c,currY:u}=this.lastMove;return e===n&&t===a||e===c&&t===u}isSquareChecked(e,t){return this.checkState.isInCheck&&this.checkState.x===e&&this.checkState.y===t}isSquarePromotionSquare(e,t){return this.promotionCoords?this.promotionCoords.x===e&&this.promotionCoords.y===t:!1}unmarkingPreviouslySlectedAndSafeSquares(){this.selectedSquare={piece:null},this.pieceSafeSquares=[],this.isPromotionActive&&(this.isPromotionActive=!1,this.promotedPiece.set(null),this.promotionCoords=null)}selectingPiece(e,t){if(this.soundsMuted=!1,this.gameOverMessage()!==void 0)return;let n=this.chessBoardView()[e][t];if(!n||this.isWrongPieceSelected(n))return;let a=!!this.selectedSquare.piece&&this.selectedSquare.x===e&&this.selectedSquare.y===t;this.unmarkingPreviouslySlectedAndSafeSquares(),!a&&(this.selectedSquare={piece:n,x:e,y:t},this.pieceSafeSquares=this.safeSquares.get(e+","+t)||[])}placingPiece(e,t){if(!this.selectedSquare.piece||!this.isSquareSafeForSelectedPiece(e,t))return;let a=(this.selectedSquare.piece===f.WhitePawn||this.selectedSquare.piece===f.BlackPawn)&&(e===7||e===0);if(!this.isPromotionActive&&a){this.pieceSafeSquares=[],this.isPromotionActive=!0,this.promotionCoords={x:e,y:t};return}let{x:u,y:m}=this.selectedSquare;this.updateBoard(u,m,e,t,this.promotedPiece())}updateBoard(e,t,n,a,c){this.chessBoard.move(e,t,n,a,c),this.chessBoardView.set(this.chessBoard.chessBoardView),this.markLastMoveAndCheckState(this.chessBoard.lastMove,this.chessBoard.checkState),this.unmarkingPreviouslySlectedAndSafeSquares(),this.gameHistoryPointer++,this.options.type==="stockfish"&&this.chessBoardService.chessBoardState$.next(this.chessBoard.boardAsFEN)}promotePiece(e){if(!this.promotionCoords||!this.selectedSquare.piece)return;this.promotedPiece.set(e);let{x:t,y:n}=this.promotionCoords,{x:a,y:c}=this.selectedSquare;this.updateBoard(a,c,t,n,this.promotedPiece())}markLastMoveAndCheckState(e,t){this.lastMove=e,this.checkState=t,this.lastMove?this.moveSound(this.lastMove.moveType):this.moveSound(new Set([B.BasicMove]))}move(e,t){this.selectingPiece(e,t),this.placingPiece(e,t)}isWrongPieceSelected(e){let t=localStorage.getItem("USER")??"guest",n=this.options.whitePlayer==="stockfish"?s.White:s.Black,a=this.options.whitePlayer===t?s.Black:s.White,c=e===e.toUpperCase();return c&&this.playerColor===s.Black||!c&&this.playerColor===s.White||this.options.type==="stockfish"&&this.playerColor===n||this.options.type==="friend"&&this.playerColor===a}showPreviousMove(e){let{board:t,checkState:n,lastMove:a}=this.gameHistory[e];this.chessBoardView.set(t),this.markLastMoveAndCheckState(a,n),this.gameHistoryPointer=e}moveSound(e){let t=new Audio("assets/sounds/move.mp3");t.muted,e.has(B.Promotion)?t.src="assets/sounds/promote.mp3":e.has(B.Capture)?t.src="assets/sounds/capture.mp3":e.has(B.Castling)&&(t.src="assets/sounds/castling.mp3"),e.has(B.CheckMate)?t.src="assets/sounds/checkmate.webm":e.has(B.Check)&&(t.src="assets/sounds/check.mp3"),!this.soundsMuted&&t.play()}closePromotionDialog(){this.unmarkingPreviouslySlectedAndSafeSquares()}surrender(){let e=this.playerColor===s.White?"Black won the game because White surrendered":"White won the game because Black surrendered";this.chessBoard._gameOverMessage=e,this.chessBoard._isGameOver=!0,this.gameOverMessage.set(e)}handleActions(e){switch(e){case"reset":this.confirmation={img:"assets/icons/restart.png",message:"Are you sure you want to reset the game?",action:()=>this.reset()};break;case"home":this.confirmation={img:"assets/icons/home.png",message:"Are you sure you want to go back to the home page?",action:()=>this.router.navigate(["/"])};break;case"surrender":this.confirmation={img:"assets/icons/finish.png",message:"Are you sure you want to surrender?",action:()=>this.surrender()};break}}doAction(){this.confirmation&&(this.confirmation.action(),this.confirmation=void 0)}reset(){this.chessBoard=new te,this.chessBoardView.set(this.chessBoard.chessBoardView),this.selectedSquare={piece:null},this.pieceSafeSquares=[],this.lastMove=this.chessBoard.lastMove,this.checkState=this.chessBoard.checkState,this.gameOverMessage.set(this.chessBoard.gameOverMessage),this.gameHistoryPointer=0,this.isPromotionActive=!1,this.promotionCoords=null,this.promotedPiece.set(null),this.flipMode.set(!1),this.soundsMuted=!0,this.confirmation=void 0,this.unmarkingPreviouslySlectedAndSafeSquares()}};o.\u0275fac=function(t){return new(t||o)(ue(ee))},o.\u0275cmp=D({type:o,selectors:[["main-board"]],inputs:{options:"options"},standalone:!0,features:[R],decls:22,vars:12,consts:[[1,"dialog"],[1,"board",3,"ngClass"],[1,"row"],[1,"square",2,"height","fit-content","width","fit-content","padding","0.25rem","visibility","hidden"],[1,"square",2,"height","fit-content","padding-block-start","0.25rem",3,"ngClass"],[1,"promotion-dialog",3,"ngClass"],[1,"overlay"],[1,"actions"],[1,"chess-btn",3,"click"],["src","assets/icons/flip.png","alt","flip"],[1,"chess-btn",3,"click","hidden"],["src","assets/icons/finish.png","alt","surrendering"],[1,"chess-btn"],["src","assets/icons/home.png","alt","home"],[3,"showPreviousMove","moveList","gameHistoryPointer","gameHistoryLength"],["src","assets/intro.png","alt","chess"],[1,"close-promotion-dialog",3,"click"],[3,"src","alt"],[1,"square",2,"width","fit-content","padding-inline","0.25rem",3,"ngClass"],[1,"square","board-square",3,"ngClass"],[1,"square","board-square",3,"click","ngClass"],[3,"ngClass"],["draggable","false",1,"piece",3,"src","alt","ngClass"],[1,"square","board-square"],["alt","",1,"piece",3,"click","src"],["src","assets/icons/restart.png","alt","restart"]],template:function(t,n){t&1&&(S(0,nt,9,1,"div",0)(1,ot,9,3,"div",0),d(2,"main",1)(3,"div",2)(4,"div",3),C(5," 0 "),l(),W(6,rt,2,4,"div",4,V),l(),W(8,ct,5,4,"div",2,V),S(10,dt,5,3,"div",5),l(),d(11,"aside")(12,"div",6)(13,"div",7)(14,"button",8),_("click",function(){return n.flipBoard()}),x(15,"img",9),l(),d(16,"button",10),_("click",function(){return n.handleActions("surrender")}),x(17,"img",11),l(),S(18,ht,2,0,"button",12),d(19,"button",8),_("click",function(){return n.handleActions("home")}),x(20,"img",13),l()(),d(21,"move-list",14),_("showPreviousMove",function(c){return n.showPreviousMove(c)}),l()()()),t&2&&(P(0,n.gameOverMessage()?0:-1),p(),P(1,n.confirmation?1:-1),p(),v("ngClass",b(9,ae,n.flipMode())),p(4),T(Q(11,et)),p(2),T(n.chessBoardView()),p(2),P(10,n.isPromotionActive?10:-1),p(6),v("hidden",n.chessBoard._isGameOver),p(2),P(18,n.options.type!=="friend"?18:-1),p(3),v("moveList",n.moveList)("gameHistoryPointer",n.gameHistoryPointer)("gameHistoryLength",n.gameHistory.length))},dependencies:[z,ne],styles:['[_nghost-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem;position:relative}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:400px;background:url("./media/intro-WKQEVYS7.png") no-repeat center;background-size:contain}@media (max-width: 514px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:325px}}@media (min-width: 515px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:467px}}@media (min-width: 715px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:667px}}@media (min-width: 1080px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:400px}}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#232323f5;padding:1rem;display:flex;flex-direction:column;align-items:center;gap:1rem;border:1px solid #444;border-radius:15px}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:transparent}.board[_ngcontent-%COMP%]{display:flex;justify-content:center;flex-direction:column-reverse;width:fit-content;gap:.25rem;background-color:#ffffffbf;padding-inline-start:.5rem;padding-inline-end:1rem;padding-block-start:1rem;padding-block-end:.25rem;border-radius:15px;overflow:hidden;position:relative}.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}.row[_ngcontent-%COMP%]{width:fit-content;display:flex;flex-direction:row;flex-wrap:wrap;gap:.2rem}.square[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:75px;width:75px;border-radius:10px;position:relative;z-index:10;font-size:12px;font-weight:600;color:var(--accent-color)}.square[_ngcontent-%COMP%]:after{content:"";position:absolute;z-index:-1;border-radius:10px;height:0;width:0;background-color:#1c64f2;box-shadow:#0003 0 15px 40px -12px inset,#0000004d 0 18px 18px -6px inset;visibility:hidden}.board-square[_ngcontent-%COMP%]{cursor:pointer;background-color:#fff;box-shadow:#0003 0 15px 40px -12px inset,#0000004d 0 18px 18px -6px inset}.flipped-shadow[_ngcontent-%COMP%]{box-shadow:#0003 0 -15px 40px -12px inset,#0000004d 0 -18px 18px -6px inset}.promotion-dialog[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;gap:1rem;background-color:#000000bf;position:absolute;top:0;left:0;z-index:100;border-radius:15px}.promotion-dialog[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]:hover:after{height:75px;width:75px;visibility:visible}.promotion-dialog[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:70px;cursor:pointer}.close-promotion-dialog[_ngcontent-%COMP%]{font-size:45px;cursor:pointer;color:#fff;position:absolute;top:1rem;right:2rem;transition:.25s ease}.close-promotion-dialog[_ngcontent-%COMP%]:hover{color:#1c64f2}.dark[_ngcontent-%COMP%]{background-color:var(--primary-color)}.light[_ngcontent-%COMP%]{background-color:#fff}.piece[_ngcontent-%COMP%]{width:60px;filter:grayscale(100) brightness(.8) contrast(1.5)}.selected-square[_ngcontent-%COMP%]:after{height:75px;width:75px;visibility:visible}.safe-square[_ngcontent-%COMP%]{position:absolute;background-color:#1c63f280;border-radius:50%;z-index:100;height:20px;width:20px;visibility:visible}.king-in-check[_ngcontent-%COMP%]{background-color:#e02424}.last-move[_ngcontent-%COMP%]{background-color:#0e9f6e}.promotion-square[_ngcontent-%COMP%]{background-color:#faca15}@media (min-width: 515px) and (max-width: 715px){.square[_ngcontent-%COMP%]{height:50px;width:50px}.safe-square[_ngcontent-%COMP%]{height:15px;width:15px;visibility:visible}.selected-square[_ngcontent-%COMP%]:after{height:50px;width:50px;visibility:visible}.piece[_ngcontent-%COMP%]{width:40px}.promotion-dialog[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]:hover:after{height:50px;width:50px;visibility:visible}}@media (max-width: 514px){.square[_ngcontent-%COMP%]{height:32px;width:32px}.safe-square[_ngcontent-%COMP%]{height:10px;width:10px;visibility:visible}.selected-square[_ngcontent-%COMP%]:after{height:32px;width:32px;visibility:visible}.piece[_ngcontent-%COMP%]{width:25px}.promotion-dialog[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]:hover:after{height:32px;width:32px;visibility:visible}}']});let r=o;return r})();var Ge=(()=>{let o=class o{constructor(e){this.http=e,this.api="https://stockfish.online/api/s/v2.php",this.stockfishOptions$=new Me({type:"stockfish",color:s.Black,whitePlayer:"stockfish",level:1,allowSelectingOtherPlayerPieces:!1})}convertColumnLetterToYCoord(e){return e.charCodeAt(0)-97}promotedPiece(e,t){return e?e==="n"?t===s.White?f.WhiteKnight:f.BlackKnight:e==="b"?t===s.White?f.WhiteBishop:f.BlackBishop:e==="r"?t===s.White?f.WhiteRook:f.BlackRook:t===s.White?f.WhiteQueen:f.BlackQueen:null}moveFromStockfishString(e,t){let n=this.convertColumnLetterToYCoord(e[0]),a=Number(e[1])-1,c=this.convertColumnLetterToYCoord(e[2]),u=Number(e[3])-1,m=this.promotedPiece(e[4],t);return{prevX:a,prevY:n,newX:u,newY:c,promotedPiece:m}}getBestMove(e,t){let n={fen:e,depth:$e[this.stockfishOptions$.value.level]},a=new Ie().appendAll(n);return this.http.get(this.api,{params:a}).pipe(Se(c=>{let u=c.bestmove.split(" ")[1];return ye(this.moveFromStockfishString(u,t))}))}};o.\u0275fac=function(t){return new(t||o)(qe(Ae))},o.\u0275prov=de({token:o,factory:o.\u0275fac,providedIn:"root"});let r=o;return r})();var ce=r=>({rotated:r}),ut=()=>["a","b","c","d","e","f","g","h"],mt=(r,o,i,e,t,n,a)=>({"flipped-shadow":r,light:o,dark:i,"selected-square":e,"last-move":t,"king-in-check":n,"promotion-square":a}),ft=r=>({"safe-square":r});function gt(r,o){if(r&1){let i=y();d(0,"div",0),x(1,"img",15),d(2,"p"),C(3),l(),d(4,"div",7)(5,"button",8),_("click",function(){w(i);let t=h();return k(t.gameOverMessage.set(void 0))}),C(6," OK "),l()(),d(7,"span",16),_("click",function(){w(i);let t=h();return k(t.gameOverMessage.set(void 0))}),C(8," \xD7 "),l()()}if(r&2){let i=h();p(3),O(" ",i.gameOverMessage()," ")}}function _t(r,o){if(r&1){let i=y();d(0,"div",0),x(1,"img",17),d(2,"p"),C(3),l(),d(4,"div",7)(5,"button",8),_("click",function(){w(i);let t=h();return k(t.doAction())}),C(6,"Yes"),l(),d(7,"button",8),_("click",function(){w(i);let t=h();return k(t.confirmation=void 0)}),C(8,"No"),l()()()}if(r&2){let i=h();p(),I("src",i.confirmation.img,N),I("alt",i.confirmation.action),p(2),O(" ",i.confirmation.message," ")}}function vt(r,o){if(r&1&&(d(0,"div",4),C(1),l()),r&2){let i=o.$implicit,e=h();v("ngClass",b(2,ce,e.flipMode())),p(),O(" ",i," ")}}function Ct(r,o){if(r&1&&x(0,"img",22),r&2){let i=h().$implicit,e=h(2);I("src",e.pieceImagePaths[i],N),I("alt",i),v("ngClass",b(3,ce,e.flipMode()))}}function xt(r,o){if(r&1){let i=y();d(0,"div",20),_("click",function(){let t=w(i).$index,n=h().$index,a=h();return k(a.move(n,t))}),x(1,"div",21),S(2,Ct,1,5,"img",22),l()}if(r&2){let i=o.$implicit,e=o.$index,t=h().$index,n=h();v("ngClass",X(3,mt,n.flipMode(),!n.isSquareDark(t,e),n.isSquareDark(t,e),n.isSquareSelected(t,e)&&!n.chessBoard.isGameOver,n.isSquareLastMove(t,e),n.isSquareChecked(t,e),n.isSquarePromotionSquare(t,e))),p(),v("ngClass",b(11,ft,n.isSquareSafeForSelectedPiece(t,e)&&!n.chessBoard.isGameOver)),p(),P(2,i?2:-1)}}function wt(r,o){if(r&1&&(d(0,"div",2)(1,"div",18),C(2),l(),W(3,xt,3,13,"div",19,V),l()),r&2){let i=o.$implicit,e=o.$index,t=h();p(),v("ngClass",b(2,ce,t.flipMode())),p(),O(" ",e+1," "),p(),T(i)}}function kt(r,o){if(r&1){let i=y();d(0,"div",23)(1,"img",24),_("click",function(){let t=w(i).$implicit,n=h(2);return k(n.promotePiece(t))}),l()()}if(r&2){let i=o.$implicit,e=h(2);p(),v("src",e.pieceImagePaths[i],N)}}function Mt(r,o){if(r&1){let i=y();d(0,"div",5),W(1,kt,2,1,"div",23,V),d(3,"span",16),_("click",function(){w(i);let t=h();return k(t.closePromotionDialog())}),C(4," \xD7 "),l()()}if(r&2){let i=h();v("ngClass",b(1,ce,i.flipMode())),p(),T(i.promotionPieces())}}function yt(r,o){if(r&1){let i=y();d(0,"button",8),_("click",function(){w(i);let t=h();return k(t.handleActions("reset"))}),x(1,"img",25),l()}}var Ke=(()=>{let o=class o extends oe{constructor(e){super(E(ee)),this.stockfishService=e,this.stockfishSubscriptions$=new Y}ngOnChanges(e){e.options&&(this.stockfishColor=this.options.whitePlayer==="stockfish"?s.White:s.Black,this.stockfishColor===s.White&&this.flipBoard())}ngOnInit(){super.ngOnInit();let e=this.chessBoardService.chessBoardState$.subscribe({next:t=>K(this,null,function*(){if(this.chessBoard.isGameOver){e.unsubscribe();return}if((t.split(" ")[1]==="w"?s.White:s.Black)!==this.stockfishColor)return;let{prevX:a,prevY:c,newX:u,newY:m,promotedPiece:M}=yield U(this.stockfishService.getBestMove(t,this.stockfishColor));this.updateBoard(a,c,u,m,M)})});this.stockfishSubscriptions$.add(e)}ngOnDestroy(){super.ngOnDestroy(),this.stockfishSubscriptions$.unsubscribe()}};o.\u0275fac=function(t){return new(t||o)(ue(Ge))},o.\u0275cmp=D({type:o,selectors:[["stockfish-board"]],standalone:!0,features:[me,he,R],decls:22,vars:12,consts:[[1,"dialog"],[1,"board",3,"ngClass"],[1,"row"],[1,"square",2,"height","fit-content","width","fit-content","padding","0.25rem","visibility","hidden"],[1,"square",2,"height","fit-content","padding-block-start","0.25rem",3,"ngClass"],[1,"promotion-dialog",3,"ngClass"],[1,"overlay"],[1,"actions"],[1,"chess-btn",3,"click"],["src","assets/icons/flip.png","alt","flip"],[1,"chess-btn",3,"click","hidden"],["src","assets/icons/finish.png","alt","surrendering"],[1,"chess-btn"],["src","assets/icons/home.png","alt","home"],[3,"showPreviousMove","moveList","gameHistoryPointer","gameHistoryLength"],["src","assets/intro.png","alt","chess"],[1,"close-promotion-dialog",3,"click"],[3,"src","alt"],[1,"square",2,"width","fit-content","padding-inline","0.25rem",3,"ngClass"],[1,"square","board-square",3,"ngClass"],[1,"square","board-square",3,"click","ngClass"],[3,"ngClass"],["draggable","false",1,"piece",3,"src","alt","ngClass"],[1,"square","board-square"],["alt","",1,"piece",3,"click","src"],["src","assets/icons/restart.png","alt","restart"]],template:function(t,n){t&1&&(S(0,gt,9,1,"div",0)(1,_t,9,3,"div",0),d(2,"main",1)(3,"div",2)(4,"div",3),C(5," 0 "),l(),W(6,vt,2,4,"div",4,V),l(),W(8,wt,5,4,"div",2,V),S(10,Mt,5,3,"div",5),l(),d(11,"aside")(12,"div",6)(13,"div",7)(14,"button",8),_("click",function(){return n.flipBoard()}),x(15,"img",9),l(),d(16,"button",10),_("click",function(){return n.handleActions("surrender")}),x(17,"img",11),l(),S(18,yt,2,0,"button",12),d(19,"button",8),_("click",function(){return n.handleActions("home")}),x(20,"img",13),l()(),d(21,"move-list",14),_("showPreviousMove",function(c){return n.showPreviousMove(c)}),l()()()),t&2&&(P(0,n.gameOverMessage()?0:-1),p(),P(1,n.confirmation?1:-1),p(),v("ngClass",b(9,ce,n.flipMode())),p(4),T(Q(11,ut)),p(2),T(n.chessBoardView()),p(2),P(10,n.isPromotionActive?10:-1),p(6),v("hidden",n.chessBoard._isGameOver),p(2),P(18,n.options.type!=="friend"?18:-1),p(3),v("moveList",n.moveList)("gameHistoryPointer",n.gameHistoryPointer)("gameHistoryLength",n.gameHistory.length))},dependencies:[z,ne],styles:['[_nghost-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem;position:relative}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:400px;background:url("./media/intro-WKQEVYS7.png") no-repeat center;background-size:contain}@media (max-width: 514px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:325px}}@media (min-width: 515px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:467px}}@media (min-width: 715px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:667px}}@media (min-width: 1080px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:400px}}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#232323f5;padding:1rem;display:flex;flex-direction:column;align-items:center;gap:1rem;border:1px solid #444;border-radius:15px}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:transparent}.board[_ngcontent-%COMP%]{display:flex;justify-content:center;flex-direction:column-reverse;width:fit-content;gap:.25rem;background-color:#ffffffbf;padding-inline-start:.5rem;padding-inline-end:1rem;padding-block-start:1rem;padding-block-end:.25rem;border-radius:15px;overflow:hidden;position:relative}.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}.row[_ngcontent-%COMP%]{width:fit-content;display:flex;flex-direction:row;flex-wrap:wrap;gap:.2rem}.square[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:75px;width:75px;border-radius:10px;position:relative;z-index:10;font-size:12px;font-weight:600;color:var(--accent-color)}.square[_ngcontent-%COMP%]:after{content:"";position:absolute;z-index:-1;border-radius:10px;height:0;width:0;background-color:#1c64f2;box-shadow:#0003 0 15px 40px -12px inset,#0000004d 0 18px 18px -6px inset;visibility:hidden}.board-square[_ngcontent-%COMP%]{cursor:pointer;background-color:#fff;box-shadow:#0003 0 15px 40px -12px inset,#0000004d 0 18px 18px -6px inset}.flipped-shadow[_ngcontent-%COMP%]{box-shadow:#0003 0 -15px 40px -12px inset,#0000004d 0 -18px 18px -6px inset}.promotion-dialog[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;gap:1rem;background-color:#000000bf;position:absolute;top:0;left:0;z-index:100;border-radius:15px}.promotion-dialog[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]:hover:after{height:75px;width:75px;visibility:visible}.promotion-dialog[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:70px;cursor:pointer}.close-promotion-dialog[_ngcontent-%COMP%]{font-size:45px;cursor:pointer;color:#fff;position:absolute;top:1rem;right:2rem;transition:.25s ease}.close-promotion-dialog[_ngcontent-%COMP%]:hover{color:#1c64f2}.dark[_ngcontent-%COMP%]{background-color:var(--primary-color)}.light[_ngcontent-%COMP%]{background-color:#fff}.piece[_ngcontent-%COMP%]{width:60px;filter:grayscale(100) brightness(.8) contrast(1.5)}.selected-square[_ngcontent-%COMP%]:after{height:75px;width:75px;visibility:visible}.safe-square[_ngcontent-%COMP%]{position:absolute;background-color:#1c63f280;border-radius:50%;z-index:100;height:20px;width:20px;visibility:visible}.king-in-check[_ngcontent-%COMP%]{background-color:#e02424}.last-move[_ngcontent-%COMP%]{background-color:#0e9f6e}.promotion-square[_ngcontent-%COMP%]{background-color:#faca15}@media (min-width: 515px) and (max-width: 715px){.square[_ngcontent-%COMP%]{height:50px;width:50px}.safe-square[_ngcontent-%COMP%]{height:15px;width:15px;visibility:visible}.selected-square[_ngcontent-%COMP%]:after{height:50px;width:50px;visibility:visible}.piece[_ngcontent-%COMP%]{width:40px}.promotion-dialog[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]:hover:after{height:50px;width:50px;visibility:visible}}@media (max-width: 514px){.square[_ngcontent-%COMP%]{height:32px;width:32px}.safe-square[_ngcontent-%COMP%]{height:10px;width:10px;visibility:visible}.selected-square[_ngcontent-%COMP%]:after{height:32px;width:32px;visibility:visible}.piece[_ngcontent-%COMP%]{width:25px}.promotion-dialog[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]:hover:after{height:32px;width:32px;visibility:visible}}']});let r=o;return r})();var Ye=(()=>{let o=class o{constructor(){this.firebaseService=E(ge),this.id=E(J).snapshot.params.id,this.localStorageUser=localStorage.getItem("USER")??""}convertColumnLetterToYCoord(e){return e.charCodeAt(0)-97}promotedPiece(e,t){return e?e==="n"?t===s.White?f.WhiteKnight:f.BlackKnight:e==="b"?t===s.White?f.WhiteBishop:f.BlackBishop:e==="r"?t===s.White?f.WhiteRook:f.BlackRook:t===s.White?f.WhiteQueen:f.BlackQueen:null}moveFromStockfishString(e,t){let n=this.convertColumnLetterToYCoord(e[0]),a=Number(e[1])-1,c=this.convertColumnLetterToYCoord(e[2]),u=Number(e[3])-1,m=this.promotedPiece(e[4],t);return{prevX:a,prevY:n,newX:u,newY:c,promotedPiece:m}}getGame(e){return this.firebaseService.getGame(e)}updateGame(e,t){this.firebaseService.updateGame(e,t)}};o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=de({token:o,factory:o.\u0275fac,providedIn:"root"});let r=o;return r})();function _e(r){r||(Fe(_e),r=E(pe));let o=new ke(i=>r.onDestroy(i.next.bind(i)));return i=>i.pipe(Oe(o))}function bt(r){switch(r){case"k":return f.WhiteKing;case"q":return f.WhiteQueen;case"r":return f.WhiteRook;case"b":return f.WhiteBishop;case"n":return f.WhiteKnight;case"p":return f.WhitePawn;case"K":return f.BlackKing;case"Q":return f.BlackQueen;case"R":return f.BlackRook;case"B":return f.BlackBishop;case"N":return f.BlackKnight;default:return null}}function ve(r){let o=+r.charAt(0),i=+r.charAt(1),e=+r.charAt(2),t=+r.charAt(3),n=bt(r.charAt(4));return[o,i,e,t,n]}var le=r=>({rotated:r}),Pt=()=>["a","b","c","d","e","f","g","h"],St=(r,o,i,e,t,n,a)=>({"flipped-shadow":r,light:o,dark:i,"selected-square":e,"last-move":t,"king-in-check":n,"promotion-square":a}),Ot=r=>({"safe-square":r});function Bt(r,o){if(r&1){let i=y();d(0,"div",0),x(1,"img",15),d(2,"p"),C(3),l(),d(4,"div",7)(5,"button",8),_("click",function(){w(i);let t=h();return k(t.gameOverMessage.set(void 0))}),C(6," OK "),l()(),d(7,"span",16),_("click",function(){w(i);let t=h();return k(t.gameOverMessage.set(void 0))}),C(8," \xD7 "),l()()}if(r&2){let i=h();p(3),O(" ",i.gameOverMessage()," ")}}function qt(r,o){if(r&1){let i=y();d(0,"div",0),x(1,"img",17),d(2,"p"),C(3),l(),d(4,"div",7)(5,"button",8),_("click",function(){w(i);let t=h();return k(t.doAction())}),C(6,"Yes"),l(),d(7,"button",8),_("click",function(){w(i);let t=h();return k(t.confirmation=void 0)}),C(8,"No"),l()()()}if(r&2){let i=h();p(),I("src",i.confirmation.img,N),I("alt",i.confirmation.action),p(2),O(" ",i.confirmation.message," ")}}function Ft(r,o){if(r&1&&(d(0,"div",4),C(1),l()),r&2){let i=o.$implicit,e=h();v("ngClass",b(2,le,e.flipMode())),p(),O(" ",i," ")}}function Et(r,o){if(r&1&&x(0,"img",22),r&2){let i=h().$implicit,e=h(2);I("src",e.pieceImagePaths[i],N),I("alt",i),v("ngClass",b(3,le,e.flipMode()))}}function Vt(r,o){if(r&1){let i=y();d(0,"div",20),_("click",function(){let t=w(i).$index,n=h().$index,a=h();return k(a.move(n,t))}),x(1,"div",21),S(2,Et,1,5,"img",22),l()}if(r&2){let i=o.$implicit,e=o.$index,t=h().$index,n=h();v("ngClass",X(3,St,n.flipMode(),!n.isSquareDark(t,e),n.isSquareDark(t,e),n.isSquareSelected(t,e)&&!n.chessBoard.isGameOver,n.isSquareLastMove(t,e),n.isSquareChecked(t,e),n.isSquarePromotionSquare(t,e))),p(),v("ngClass",b(11,Ot,n.isSquareSafeForSelectedPiece(t,e)&&!n.chessBoard.isGameOver)),p(),P(2,i?2:-1)}}function Wt(r,o){if(r&1&&(d(0,"div",2)(1,"div",18),C(2),l(),W(3,Vt,3,13,"div",19,V),l()),r&2){let i=o.$implicit,e=o.$index,t=h();p(),v("ngClass",b(2,le,t.flipMode())),p(),O(" ",e+1," "),p(),T(i)}}function Tt(r,o){if(r&1){let i=y();d(0,"div",23)(1,"img",24),_("click",function(){let t=w(i).$implicit,n=h(2);return k(n.promotePiece(t))}),l()()}if(r&2){let i=o.$implicit,e=h(2);p(),v("src",e.pieceImagePaths[i],N)}}function It(r,o){if(r&1){let i=y();d(0,"div",5),W(1,Tt,2,1,"div",23,V),d(3,"span",16),_("click",function(){w(i);let t=h();return k(t.closePromotionDialog())}),C(4," \xD7 "),l()()}if(r&2){let i=h();v("ngClass",b(1,le,i.flipMode())),p(),T(i.promotionPieces())}}function At(r,o){if(r&1){let i=y();d(0,"button",8),_("click",function(){w(i);let t=h();return k(t.handleActions("reset"))}),x(1,"img",25),l()}}var Ue=(()=>{let o=class o extends oe{constructor(){super(E(ee)),this.gameId=E(J).snapshot.params.id,this.destroyRef=E(pe),this.friendSubscriptions$=new Y,this.friendService=E(Ye),this.localStorageUser=localStorage.getItem("USER")??"guest",this.lm=L(null),this.isReloaded=!0,this.newMove=(e,t,n,a,c)=>c?[e,t,n,a,c]:[e,t,n,a],this.gameId&&this.friendService.getGame(this.gameId).pipe(_e(this.destroyRef)).subscribe({next:e=>K(this,null,function*(){if(!e||(this.gameStatus=e.status,e.gameOverMessage&&(this.chessBoard._gameOverMessage=e.gameOverMessage),this.gameOverMessage.set(this.chessBoard.gameOverMessage),!e.moves?.length)||e.moves[e.moves?.length-1]===this.chessBoard.moves[this.chessBoard.moves?.length-1])return;this.chessBoard._moves=e.moves;let[t,n,a,c,u]=ve(e.moves[e.moves?.length-1]);this.updateBoard(t,n,a,c,u)})})}ngOnChanges(e){e.options&&(this.friendColor=this.localStorageUser===this.options.whitePlayer?s.Black:s.White,this.friendColor===s.White&&this.flipBoard())}ngOnInit(){return K(this,null,function*(){we(o.prototype,this,"ngOnInit").call(this),yield U(this.friendService.getGame(this.gameId)),this.reDrawBoard(),this.chessBoardService.lastMove$.pipe(_e(this.destroyRef)).subscribe({next:e=>{if(!e||this.playerColor!==this.friendColor&&!this.isReloaded)return;let[t,n,a,c,u]=e;this.postMove(this.newMove(t,n,a,c,u))}})})}reDrawBoard(){this.chessBoard.moves.forEach(e=>{let[t,n,a,c,u]=ve(e);this.updateBoard(t,n,a,c,u)}),this.isReloaded=!1,this.chessBoard._isGameOver=this.gameStatus===fe.Finished}updateBoard(e,t,n,a,c){super.updateBoard(e,t,n,a,c),!this.isReloaded&&this.chessBoardService.lastMove$.next([e,t,n,a,c])}promotePiece(e){if(super.promotePiece(e),!this.promotionCoords||!this.selectedSquare.piece)return;let{x:t,y:n}=this.promotionCoords,{x:a,y:c}=this.selectedSquare;this.postMove(this.newMove(a,c,t,n,e))}move(e,t){super.move(e,t),this.chessBoard.isGameOver&&this.updateGame(fe.Finished,this.playerColor,this.chessBoard.gameOverMessage)}ngOnDestroy(){super.ngOnDestroy(),this.friendSubscriptions$.unsubscribe()}updateGame(e=fe.Active,t=null,n=null){let a=xe(re({},this.options),{moves:this.chessBoard.moves,status:e,winner:t,gameOverMessage:n});this.friendService.updateGame(this.gameId,a)}postMove(e){if(this.chessBoard.isGameOver)return;let t=JSON.stringify(e).split("[").join("").split("]").join("").split(",").join("").split('"').join("");this.chessBoard._moves.push(t),this.updateGame()}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=D({type:o,selectors:[["online-board"]],standalone:!0,features:[me,he,R],decls:22,vars:12,consts:[[1,"dialog"],[1,"board",3,"ngClass"],[1,"row"],[1,"square",2,"height","fit-content","width","fit-content","padding","0.25rem","visibility","hidden"],[1,"square",2,"height","fit-content","padding-block-start","0.25rem",3,"ngClass"],[1,"promotion-dialog",3,"ngClass"],[1,"overlay"],[1,"actions"],[1,"chess-btn",3,"click"],["src","assets/icons/flip.png","alt","flip"],[1,"chess-btn",3,"click","hidden"],["src","assets/icons/finish.png","alt","surrendering"],[1,"chess-btn"],["src","assets/icons/home.png","alt","home"],[3,"showPreviousMove","moveList","gameHistoryPointer","gameHistoryLength"],["src","assets/intro.png","alt","chess"],[1,"close-promotion-dialog",3,"click"],[3,"src","alt"],[1,"square",2,"width","fit-content","padding-inline","0.25rem",3,"ngClass"],[1,"square","board-square",3,"ngClass"],[1,"square","board-square",3,"click","ngClass"],[3,"ngClass"],["draggable","false",1,"piece",3,"src","alt","ngClass"],[1,"square","board-square"],["alt","",1,"piece",3,"click","src"],["src","assets/icons/restart.png","alt","restart"]],template:function(t,n){t&1&&(S(0,Bt,9,1,"div",0)(1,qt,9,3,"div",0),d(2,"main",1)(3,"div",2)(4,"div",3),C(5," 0 "),l(),W(6,Ft,2,4,"div",4,V),l(),W(8,Wt,5,4,"div",2,V),S(10,It,5,3,"div",5),l(),d(11,"aside")(12,"div",6)(13,"div",7)(14,"button",8),_("click",function(){return n.flipBoard()}),x(15,"img",9),l(),d(16,"button",10),_("click",function(){return n.handleActions("surrender")}),x(17,"img",11),l(),S(18,At,2,0,"button",12),d(19,"button",8),_("click",function(){return n.handleActions("home")}),x(20,"img",13),l()(),d(21,"move-list",14),_("showPreviousMove",function(c){return n.showPreviousMove(c)}),l()()()),t&2&&(P(0,n.gameOverMessage()?0:-1),p(),P(1,n.confirmation?1:-1),p(),v("ngClass",b(9,le,n.flipMode())),p(4),T(Q(11,Pt)),p(2),T(n.chessBoardView()),p(2),P(10,n.isPromotionActive?10:-1),p(6),v("hidden",n.chessBoard._isGameOver),p(2),P(18,n.options.type!=="friend"?18:-1),p(3),v("moveList",n.moveList)("gameHistoryPointer",n.gameHistoryPointer)("gameHistoryLength",n.gameHistory.length))},dependencies:[z,ne],styles:['[_nghost-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem;position:relative}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:400px;background:url("./media/intro-WKQEVYS7.png") no-repeat center;background-size:contain}@media (max-width: 514px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:325px}}@media (min-width: 515px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:467px}}@media (min-width: 715px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:667px}}@media (min-width: 1080px){[_nghost-%COMP%]   aside[_ngcontent-%COMP%]{min-width:400px}}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#232323f5;padding:1rem;display:flex;flex-direction:column;align-items:center;gap:1rem;border:1px solid #444;border-radius:15px}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none}[_nghost-%COMP%]   aside[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:transparent}.board[_ngcontent-%COMP%]{display:flex;justify-content:center;flex-direction:column-reverse;width:fit-content;gap:.25rem;background-color:#ffffffbf;padding-inline-start:.5rem;padding-inline-end:1rem;padding-block-start:1rem;padding-block-end:.25rem;border-radius:15px;overflow:hidden;position:relative}.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}.row[_ngcontent-%COMP%]{width:fit-content;display:flex;flex-direction:row;flex-wrap:wrap;gap:.2rem}.square[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:75px;width:75px;border-radius:10px;position:relative;z-index:10;font-size:12px;font-weight:600;color:var(--accent-color)}.square[_ngcontent-%COMP%]:after{content:"";position:absolute;z-index:-1;border-radius:10px;height:0;width:0;background-color:#1c64f2;box-shadow:#0003 0 15px 40px -12px inset,#0000004d 0 18px 18px -6px inset;visibility:hidden}.board-square[_ngcontent-%COMP%]{cursor:pointer;background-color:#fff;box-shadow:#0003 0 15px 40px -12px inset,#0000004d 0 18px 18px -6px inset}.flipped-shadow[_ngcontent-%COMP%]{box-shadow:#0003 0 -15px 40px -12px inset,#0000004d 0 -18px 18px -6px inset}.promotion-dialog[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;gap:1rem;background-color:#000000bf;position:absolute;top:0;left:0;z-index:100;border-radius:15px}.promotion-dialog[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]:hover:after{height:75px;width:75px;visibility:visible}.promotion-dialog[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:70px;cursor:pointer}.close-promotion-dialog[_ngcontent-%COMP%]{font-size:45px;cursor:pointer;color:#fff;position:absolute;top:1rem;right:2rem;transition:.25s ease}.close-promotion-dialog[_ngcontent-%COMP%]:hover{color:#1c64f2}.dark[_ngcontent-%COMP%]{background-color:var(--primary-color)}.light[_ngcontent-%COMP%]{background-color:#fff}.piece[_ngcontent-%COMP%]{width:60px;filter:grayscale(100) brightness(.8) contrast(1.5)}.selected-square[_ngcontent-%COMP%]:after{height:75px;width:75px;visibility:visible}.safe-square[_ngcontent-%COMP%]{position:absolute;background-color:#1c63f280;border-radius:50%;z-index:100;height:20px;width:20px;visibility:visible}.king-in-check[_ngcontent-%COMP%]{background-color:#e02424}.last-move[_ngcontent-%COMP%]{background-color:#0e9f6e}.promotion-square[_ngcontent-%COMP%]{background-color:#faca15}@media (min-width: 515px) and (max-width: 715px){.square[_ngcontent-%COMP%]{height:50px;width:50px}.safe-square[_ngcontent-%COMP%]{height:15px;width:15px;visibility:visible}.selected-square[_ngcontent-%COMP%]:after{height:50px;width:50px;visibility:visible}.piece[_ngcontent-%COMP%]{width:40px}.promotion-dialog[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]:hover:after{height:50px;width:50px;visibility:visible}}@media (max-width: 514px){.square[_ngcontent-%COMP%]{height:32px;width:32px}.safe-square[_ngcontent-%COMP%]{height:10px;width:10px;visibility:visible}.selected-square[_ngcontent-%COMP%]:after{height:32px;width:32px;visibility:visible}.piece[_ngcontent-%COMP%]{width:25px}.promotion-dialog[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]:hover:after{height:32px;width:32px;visibility:visible}}']});let r=o;return r})();function Ht(r,o){if(r&1&&x(0,"main-board",0),r&2){let i=h(2);v("options",i.options())}}function Nt(r,o){if(r&1&&x(0,"stockfish-board",0),r&2){let i=h(2);v("options",i.options())}}function Dt(r,o){if(r&1&&x(0,"online-board",0),r&2){let i=h(2);v("options",i.options())}}function Lt(r,o){if(r&1&&S(0,Ht,1,1,"main-board",0)(1,Nt,1,1)(2,Dt,1,1),r&2){let i,e=h();P(0,((i=e.options())==null?null:i.type)==="local"?0:((i=e.options())==null?null:i.type)==="stockfish"?1:2)}}var Rt=De(ze.firebaseConfig),Kn=Le(Rt),Yn=(()=>{let o=class o{constructor(){this.fb=E(ge),this.id=E(J).snapshot.params.id,this.options=L(history.state?.options??null)}ngOnInit(){return K(this,null,function*(){this.id&&this.options.set(yield U(this.fb.getGame(this.id)))})}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=D({type:o,selectors:[["app-game-page"]],standalone:!0,features:[R],decls:1,vars:1,consts:[[3,"options"]],template:function(t,n){t&1&&S(0,Lt,3,1),t&2&&P(0,n.options()?0:-1)},dependencies:[Ne,oe,Ke,Ue],styles:["[_nghost-%COMP%]{width:100%;padding-block:2rem;padding-inline:1rem}"]});let r=o;return r})();export{Yn as default};
